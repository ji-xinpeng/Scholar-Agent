# Scholar Agent 前端交互文档

> 版本: v1.1 | 更新日期: 2026-02-16

---

## 1. 全局布局

```
┌──────────────────────────────────────────────────┐
│  顶部导航栏 (Navbar, 高 56px, 固定)              │
├──────────────────────────────────────────────────┤
│                                                  │
│  页面内容区 (flex-1, 充满剩余高度)                │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 1.1 顶部导航栏

| 元素 | 说明 |
|------|------|
| Logo + 品牌名 | 左侧显示图标 + "Scholar Agent"，点击跳转首页 `/` |
| 智能助手 | 导航到 `/`，高亮当前选中 |
| 文档管理 | 导航到 `/documents`，高亮当前选中 |
| 个人中心 | 导航到 `/profile`，高亮当前选中 |

---

## 2. 智能助手页面 (`/`)

### 2.1 页面结构

```
┌──────────────────────────────────────────────────┐
│ Navbar                                           │
├────────┬─────────────────────────────────────────┤
│        │                                         │
│ 历史   │   消息区域 (可滚动)                      │
│ 记录   │   - 用户消息 (右侧蓝色气泡)              │
│ 侧边栏 │   - 助手消息 (左侧白色气泡)              │
│ 240px  │   - 任务进度卡片 (Agent模式)             │
│        │                                         │
│        ├─────────────────────────────────────────┤
│        │ 模式开关 | 联网搜索开关                   │
│        │ [图片预览条]                             │
│        │ [📎图片] [输入框............] [发送➤]    │
└────────┴─────────────────────────────────────────┘
```

### 2.2 左侧历史记录侧边栏

| 交互 | 行为 |
|------|------|
| 点击「新建对话」按钮 | 清空当前消息和会话ID，输入框获取焦点 |
| 点击某条历史记录 | 调用 `GET /chat/sessions/{id}/messages` 加载该会话消息 |
| 点击历史记录的删除图标 | 调用 `DELETE /chat/sessions/{id}` 删除该会话；若删除的是当前会话则触发新建对话 |
| 点击「收起」按钮 | 侧边栏收缩为 48px 宽的图标栏，只保留新建和展开按钮 |
| 数据加载时机 | 每次 `sessionId` 变化时重新调用 `GET /chat/sessions` 刷新列表 |

### 2.3 空状态（无消息时）

居中显示：
- Scholar Agent 图标 + 标题
- 副标题："AI驱动的智能学术研究助手..."
- 4 个快捷问题按钮（2×2 网格），点击后填入输入框并聚焦

### 2.4 模式与功能开关

| 开关 | 状态 | 说明 |
|------|------|------|
| 模式切换 | `normal` / `agent` | 点击切换，`agent` 时高亮紫色，输入框占位符变为"描述你的研究任务..." |
| 联网搜索 | `true` / `false` | 点击切换，开启时高亮绿色 |

### 2.5 图片上传

| 交互 | 行为 |
|------|------|
| 点击图片按钮 | 弹出文件选择器（仅限 `image/*`） |
| 选择图片后 | 在输入框上方显示缩略图预览（高 80px），右上角显示红色×删除按钮 |
| 点击×删除 | 移除图片预览 |
| 发送时 | 图片以 base64 形式显示在用户消息气泡中；纯图片（无文字）也可发送 |

### 2.6 消息发送流程

```
用户点击发送 / 按 Enter（非 Shift+Enter）
    │
    ├─ 前置校验：文字或图片至少有一项，且不在 loading 状态
    │
    ├─ 立即添加用户消息到 messages 列表（乐观更新）
    ├─ 清空输入框、图片预览
    ├─ 设置 isLoading = true
    │
    ├─ 调用 POST /chat/chat (SSE 流)
    │   ├─ 请求体: { message, session_id, user_id, mode, web_search }
    │   ├─ 响应头 X-Session-Id: 返回会话ID（首次对话时用此更新 sessionId）
    │   │
    │   ├─ SSE 事件处理：
    │   │   ├─ event: plan      → 渲染任务进度卡片（Agent模式）
    │   │   ├─ event: step_start    → 对应步骤状态变为 "running"
    │   │   ├─ event: step_progress → 更新进度条和提示文字
    │   │   ├─ event: step_complete → 对应步骤状态变为 "done"
    │   │   ├─ event: stream    → 累加内容到 streamingContent，实时渲染
    │   │   ├─ event: cost      → 更新 lastCost，显示费用标签
    │   │   └─ event: done      → 标记完成
    │   │
    │   ├─ 错误处理：
    │   │   └─ HTTP 402 → 显示余额不足红色横幅 + 充值链接
    │   │
    │   └─ 流结束（onDone）
    │       ├─ 将累积内容添加为 assistant 消息
    │       ├─ 清空 streamingContent
    │       └─ 设置 isLoading = false
    │
    └─ 若首次对话，用返回的 session_id 更新状态
```

### 2.7 消息气泡渲染

| 角色 | 样式 | 内容渲染 |
|------|------|---------|
| 用户 | 右侧，蓝色背景白色文字，右上角小圆角 | 纯文本 + 可选图片 |
| 助手 | 左侧，白色背景灰色文字，左上角小圆角 | 支持 Markdown：`**粗体**`、`## 标题`、`- 列表项`、换行 |
| 助手（加载中） | 左侧，三个跳动的灰色圆点 | 无文字时显示 |

### 2.8 任务进度卡片（Agent 模式）

显示在消息流中，白色卡片带边框：
- 标题："研究计划"
- 每个步骤一行：
  - ⭕ 灰色空心圆 = pending
  - 🔄 旋转的蓝色加载图标 = running（附带进度条和提示文字）
  - ✅ 绿色对勾 = done（文字加删除线）

---

## 3. 文档管理页面 (`/documents`)

### 3.1 页面结构

```
┌──────────────────────────────────────────────────┐
│ Navbar                                           │
├──────────┬───────────────────────────────────────┤
│          │ ┌─────────────────────────────────┐   │
│ 文件夹    │ │  拖拽上传区域                    │   │
│ 侧边栏   │ └─────────────────────────────────┘   │
│ 240px    │ [🔍 搜索文档...]                      │
│          │                                       │
│          │  文档列表 (可滚动)                      │
│          │  ┌──────────────────────────────┐     │
│          │  │ 📄 文件名    大小 · 时间 · 类型  🗑 │ │
│          │  └──────────────────────────────┘     │
│          │                                       │
│          │  [◀] [1] [2] [3] [▶] 共计: N          │
└──────────┴───────────────────────────────────────┘
```

### 3.2 文件夹侧边栏

| 交互 | 行为 |
|------|------|
| 点击「全部文档」 | `selectedFolder = null`，加载所有文档，页码重置为 1 |
| 点击某个文件夹 | `selectedFolder = folder.id`，加载该文件夹文档，页码重置为 1 |
| 点击文件夹右侧删除图标 | 调用 `DELETE /documents/folders/{id}`；该文件夹下的文档 folder_id 置为 null |
| 点击 ➕ 新建文件夹 | 展开输入框，回车或点击"添加"后调用 `POST /documents/folders` |
| 每个文件夹右侧 | 显示该文件夹的文档数量（`document_count`） |

### 3.3 上传区域

| 交互 | 行为 |
|------|------|
| 点击上传区域 | 弹出文件选择器（支持多选），接受 `.pdf,.doc,.docx,.md,.txt` |
| 拖拽文件到上传区域 | 触发上传 |
| 上传过程中 | 图标变为蓝色弹跳动画，文字显示"上传中..." |
| 上传完成 | 自动刷新文档列表和文件夹列表 |
| 上传限制 | 单文件最大 100MB；空文件拒绝 |

### 3.4 搜索

- 客户端过滤，基于 `original_name` 模糊匹配（大小写不敏感）
- 实时过滤，无需按回车

### 3.5 文档列表

| 元素 | 说明 |
|------|------|
| 文件图标 | PDF 为红色文档图标，其他为蓝色文件图标 |
| 文件名 | 显示 `original_name`，超长截断 |
| 元信息 | 格式化文件大小 · 相对时间 · 文件类型大写 |
| 删除按钮 | 鼠标悬浮时显示，点击调用 `DELETE /documents/{id}` |

### 3.6 分页

- 每页 10 条（`page_size = 10`）
- 总页数 > 1 时显示分页栏
- 当前页高亮为蓝色
- 显示"共计: N"

---

## 4. 个人中心页面 (`/profile`)

### 4.1 页面结构

```
┌──────────────────────────────────────────────────┐
│ Navbar                                           │
├──────────────────────────────────────────────────┤
│                最大宽度 896px 居中                 │
│  ┌──────────┐  ┌────────────────────────────┐    │
│  │          │  │ 个人信息编辑卡片             │    │
│  │ 个人信息  │  │  显示名称 / 研究方向 /       │    │
│  │ 卡片      │  │  所属机构 / 知识水平 /       │    │
│  │ (头像     │  │  个人简介                   │    │
│  │  名称     │  │  [编辑] / [保存]            │    │
│  │  方向     │  └────────────────────────────┘    │
│  │  机构     │  ┌────────────────────────────┐    │
│  │  等级)    │  │ 模型设置与充值              │    │
│  ├──────────┤  │  [免费模式] [付费模式]       │    │
│  │ 账户卡片  │  │  充值: [¥50][¥100][¥200]    │    │
│  │ 模式/余额 │  │  [自定义金额] [支付]        │    │
│  ├──────────┤  └────────────────────────────┘    │
│  │ 用量统计  │                                    │
│  │ 今日/累计 │                                    │
│  │ 定价信息  │                                    │
│  └──────────┘                                    │
└──────────────────────────────────────────────────┘
```

### 4.2 左侧个人信息卡片（只读展示）

| 元素 | 说明 |
|------|------|
| 头像 | 渐变色圆形图标（无真实头像时） |
| 显示名称 | `display_name` |
| 研究方向 | `research_field`，未设置显示"未设置研究方向" |
| 所属机构 | `institution`，未设置显示"未设置机构" |
| 知识水平 | 蓝色标签，显示 `knowledge_level` |

### 4.3 左侧账户卡片

| 元素 | 说明 |
|------|------|
| 模式 | 标签显示"免费"（灰色）或"付费"（琥珀色） |
| 余额 | 显示 `¥{balance}`，保留两位小数 |

### 4.4 右侧个人信息编辑

| 交互 | 行为 |
|------|------|
| 点击「编辑」 | 所有字段变为可编辑输入框，按钮变为「保存」 |
| 点击「保存」 | 调用 `PUT /users/profile`，成功后退出编辑模式，顶部弹出绿色提示"个人资料保存成功！"（3秒消失） |
| 可编辑字段 | display_name, research_field, institution, knowledge_level（下拉选择）, bio（多行文本） |
| knowledge_level 选项 | beginner=初级, intermediate=中级, advanced=高级 |

### 4.5 右侧模型设置与充值

| 交互 | 行为 |
|------|------|
| 点击「免费模式」卡片 | 调用 `PUT /users/profile` 将 model_mode 设为 "free"，选中时蓝色边框 |
| 点击「付费模式」卡片 | 调用 `PUT /users/profile` 将 model_mode 设为 "paid"，选中时琥珀色边框 |
| 点击 ¥50 / ¥100 / ¥200 | 调用 `POST /users/recharge`，成功后刷新资料，弹出"充值 ¥N 成功！" |
| 自定义金额 | 输入数字后点击「支付」，同上 |

---

## 5. 通用交互规范

### 5.1 加载状态

| 场景 | 表现 |
|------|------|
| 聊天等待回复 | 显示跳动圆点动画 |
| 文件上传中 | 上传图标弹跳 + 文字"上传中..." |
| 保存个人资料 | 按钮文字变为"保存中..."，按钮禁用 |
| 页面初始化 | 页面居中显示"加载中..." |

### 5.2 提示信息 (Toast)

- 固定在页面顶部居中
- 绿色背景白色文字
- 自动 3 秒后消失
- 淡入动画

### 5.3 消息自动滚动

- 新消息、流式内容更新、任务步骤变化时，自动滚动到底部
- 使用 `scrollIntoView({ behavior: "smooth" })`

### 5.4 键盘快捷键

| 快捷键 | 页面 | 行为 |
|--------|------|------|
| Enter | 聊天页 | 发送消息 |
| Shift + Enter | 聊天页 | 换行（不发送） |
| Enter | 文档页新建文件夹 | 确认创建 |
